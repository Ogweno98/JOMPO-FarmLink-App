<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Market Access | JOMPO FarmLink</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <link rel="stylesheet" href="style.css" />
</head>
<body class="bg-green-50 font-sans">

  <!-- Navbar -->
  <nav class="bg-green-800 text-white p-4 flex justify-between items-center">
    <a href="index.html" class="text-2xl font-bold">JOMPO FarmLink</a>
    <div class="flex gap-4">
      <a href="dashboard.html" class="hover:underline">Dashboard</a>
      <a href="farm-records.html" class="hover:underline">Farm Records</a>
      <a href="market-access.html" class="font-semibold underline">Market Access</a>
      <a href="community.html" class="hover:underline">Community</a>
      <a href="support.html" class="hover:underline">Support</a>
    </div>
  </nav>

  <!-- Header -->
  <section class="text-center py-10 bg-green-100">
    <h1 class="text-4xl font-bold text-green-800 mb-2">Market Access</h1>
    <p class="text-gray-700">Connect farmers directly with buyers and explore regional market opportunities.</p>
  </section>

  <!-- Form Section -->
  <section class="p-6 md:px-20">
    <h2 class="text-2xl font-semibold text-green-800 mb-4">Post Your Produce</h2>
    <form id="marketForm" class="bg-white p-6 rounded-lg shadow-md space-y-4">
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Product Name</label>
        <input type="text" id="productName" placeholder="e.g. Maize" required class="border rounded w-full px-4 py-2 focus:ring-2 focus:ring-green-600 focus:outline-none">
      </div>
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Price per kg (KES)</label>
        <input type="number" id="price" placeholder="e.g. 80" required class="border rounded w-full px-4 py-2 focus:ring-2 focus:ring-green-600 focus:outline-none">
      </div>
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Location</label>
        <input type="text" id="location" placeholder="e.g. Kisumu" required class="border rounded w-full px-4 py-2 focus:ring-2 focus:ring-green-600 focus:outline-none">
      </div>
      <button type="submit" class="bg-green-700 text-white px-6 py-2 rounded-lg hover:bg-green-800 transition">Add Product</button>
    </form>
  </section>

  <!-- Market List -->
  <section class="p-6 md:px-20">
    <h2 class="text-2xl font-semibold text-green-800 mb-4">Available Produce</h2>
    <ul id="marketList" class="grid md:grid-cols-3 gap-6"></ul>
  </section>

  <!-- Footer -->
  <footer class="bg-green-800 text-white text-center py-4 mt-10">
    <p>&copy; 2025 JOMPO Digital Solutions. All rights reserved.</p>
  </footer>

  <!-- Scripts -->
  <script src="app.js"></script>
  <script src="navbar.js"></script>
  <script>
    // Firebase Firestore Integration for Market Access
    const db = firebase.firestore();
    const marketForm = document.getElementById("marketForm");
    const marketList = document.getElementById("marketList");

    marketForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const productName = document.getElementById("productName").value;
      const price = document.getElementById("price").value;
      const location = document.getElementById("location").value;

      try {
        await db.collection("marketAccess").add({
          productName,
          price,
          location,
          timestamp: new Date()
        });
        marketForm.reset();
        loadMarketItems();
      } catch (error) {
        console.error("Error adding item:", error);
      }
    });

    async function loadMarketItems() {
      marketList.innerHTML = "";
      try {
        const snapshot = await db.collection("marketAccess").orderBy("timestamp", "desc").get();
        if (snapshot.empty) {
          marketList.innerHTML = "<p class='text-gray-600'>No products available yet.</p>";
          return;
        }
        snapshot.forEach(doc => {
          const data = doc.data();
          const li = document.createElement("li");
          li.className = "bg-white p-4 rounded-lg shadow";
          li.innerHTML = `
            <h3 class="text-lg font-semibold text-green-800">${data.productName}</h3>
            <p>Price: <span class="font-semibold">${data.price} KES/kg</span></p>
            <p>Location: ${data.location}</p>
          `;
          marketList.appendChild(li);
        });
      } catch (error) {
        console.error("Error fetching market items:", error);
      }
    }

    // Load products on page load
    window.onload = loadMarketItems;
  </script>

  <!-- ðŸŒ¿ Floating Chatbot -->
  <div id="chatbot"></div>
  <script src="chatbot.js"></script>
</body>
</html>
